# Проектная работа по модулю
## SQL и получение данных
                         
Перейти по ссылке и ознакомиться с [описанием базы данных](https://edu.postgrespro.ru/bookings.pdf)

В работе использовался локальный тип подключения, 

![](https://github.com/520911/SQL-final/blob/main/localhost_db_er.png)

![Файл с бэкапом базы данных](https://github.com/520911/SQL-final/blob/main/avia.backup)

[Файл с sql запросами по заданию](https://github.com/520911/SQL-final/blob/main/laboratory.sql)

### Краткое описание БД - из каких таблиц и представлений состоит.

#### Таблица **aircrafts**:

- **aircraft_code** - первичный ключ, **тип данных** - bpchar(3), **ограничения** - not null, **индекс** - btree, **комментарий** - Код самолета, IATA.
- **model**, **тип данных** - text, **ограничения** - not null, **комментарий** - Модель самолета
- **range**, **тип данных** - int4, **ограничения** - not null, check range > 0, **комментарий** - Максимальная дальность полета, км

#### Таблица **airports**:

- **airport_code** - первичный ключ, **тип данных** - bpchar(3), **ограничения** - not null, **индекс** - btree, **комментарий** - Код аэропорта
- **airport_name**, **тип данных** - text, **ограничения** - not null, **комментарий** - Название аэропорта
- **city**, **тип данных** - text, **ограничения** - not null, **комментарий** - Город
- **longitude**, **тип данных** - float8, **ограничения** - not null, **комментарий** - Координаты аэропорта: долгота
- **latitude**, **тип данных** - float8, **ограничения** - not null, **комментарий** - Координаты аэропорта: широта
- **timezone**, **тип данных** - text, **ограничения** - not null, **комментарий** - Временная зона аэропорта

#### Таблица **boarding_passes**:

- **ticket_no**, **тип данных** - bpchar(13), **ограничения** - not null, **индекс** - btree, **комментарий** - Номер билета
- **flight_id**, **тип данных** - int4, **ограничения** - not null, **индекс** - btree, **комментарий** - Идентификатор рейса
- **boarding_no**, **тип данных** - int44, **ограничения** - not null, **комментарий** - Номер посадочного талона
- **seat_no**, **тип данных** - varchar(4), **ограничения** - not null, **индекс** - btree, **комментарий** - Номер места
- PRIMARY KEY, btree (ticket_no, flight_id)
- UNIQUE CONSTRAINT, btree (flight_id, boarding_no)
- UNIQUE CONSTRAINT, btree (flight_id, seat_no)

#### Таблица **bookings**:

- **book_ref** - первичный ключ, **тип данных** - bpchar(6), **ограничения** - not null, **индекс** - btree, **комментарий** - Номер бронирования
- **book_date**, **тип данных** - timestamptz, **ограничения** - not null, **комментарий** - Дата бронирования
- **total_amount**, **тип данных** - numeric(10, 2), **ограничения** - not null, **комментарий** - Полная сумма бронирования

#### Таблица **flights**:

- **flight_id** - первичный ключ, **тип данных** - serial4, **ограничения** - not null, **индекс** - btree, **комментарий** - Идентификатор рейса
- **flight_no**, **тип данных** - bpchar(6), **ограничения** - not null, **комментарий** - Номер рейса
- **scheduled_departure**, **тип данных** - timestamptz, **ограничения** - not null, **комментарий** - Время вылета по расписанию
- **scheduled_arrival**, **тип данных** - timestamptz, **ограничения** - not null, **комментарий** - Время прилёта по расписанию
- **departure_airport**, **тип данных** - bpchar(3), **ограничения** - not null, **комментарий** - Аэропорт отправления
- **arrival_airport**, **тип данных** - bpchar(3), **ограничения** - not null, **комментарий** - Аэропорт прибытия
- **status**, **тип данных** - varchar(20), **ограничения** - not null, **комментарий** - Статус рейса
- **aircraft_code**, **тип данных** - bpchar(3), **ограничения** - not null, **комментарий** - Код самолета, IATA
- **actual_departure**, **тип данных** - timestamptz, **комментарий** - Фактическое время вылета
- **actual_arrival**, **тип данных** - timestamptz, **комментарий** - Фактическое время прилёта
- UNIQUE CONSTRAINT, btree (flight_no, scheduled_departure)

#### Таблица **seats**:

- **aircraft_code**  - первичный ключ, **тип данных** - bpchar(3), **ограничения** - not null, **индекс** - btree, **комментарий** - Код самолета, IATA
- **seat_no**, **тип данных** - varchar(4), **ограничения** - not null, **комментарий** - Номер места
- **fare_conditions**, **тип данных** - varchar(10), **ограничения** - not null, **комментарий** - Класс обслуживания
- PRIMARY KEY, btree (aircraft_code, seat_no)

#### Таблица **ticket_flights**:

- **ticket_no**, **тип данных** - bpchar(13), **ограничения** - not null, **индекс** - btree, **комментарий** - Номер билета
- **flight_id**, **тип данных** - int4, **ограничения** - not null, **индекс** - btree, **комментарий** - Идентификатор рейса
- **fare_conditions**, **тип данных** - varchar(10), **ограничения** - not null, **комментарий** - Класс обслуживания
- **amount**, **тип данных** - numeric(10, 2), **ограничения** - not null, **комментарий** - Стоимость перелета
- PRIMARY KEY, btree (ticket_no, flight_id)

#### Таблица **tickets**:

- **ticket_no** - первичный ключ, **тип данных** - bpchar(13), **ограничения** - not null, **индекс** - btree, **комментарий** - Номер билета
- **book_ref**, **тип данных** - bpchar(6), **ограничения** - not null, **комментарий** - Номер бронирования
- **passenger_id**, **тип данных** - varchar(20), **ограничения** - not null, **комментарий** - Идентификатор пассажира
- **passenger_name**, **тип данных** - text, **ограничения** - not null, **комментарий** - Имя пассажира
- **contact_data**, **тип данных** - jsonb, **комментарий** - Контактные данные пассажира

#### Представление **flights_v**:

**Над таблицей flights создано представление flights_v, содержащее дополнительную информацию:**
- Расшифровку данных об аэропорте вылета
    (departure_airport, departure_airport_name, departure_city),
 - Расшифровку данных об аэропорте прибытия
    (arrival_airport, arrival_airport_name, arrival_city),
 - Местное время вылета
    (scheduled_departure_local, actual_departure_local),
 - Местное время прибытия
    (scheduled_arrival_local, actual_arrival_local),
 - Продолжительность полета
    (scheduled_duration, actual_duration)

#### Представление **routes**:

Можно выделить информацию о маршруте (номер рейса, аэропорты отправления и назначения), которая не зависит от конкретных дат рейсов.

## Бизнес задачи, которые можно решить, используя БД:
- Анализ задержки рейсов
- Анализ ликвидности рейсов, оценивая их загруженность по направлениям
- Анализ затрат по загрузке рейсов
- Анализ явки пассажиров по направлениям
- Анализ более прибыльных направлений
- Анализ по отмене бронирования
- Зависимость покупки по классам билетов от расстояния между городами

